<!DOCTYPE html>
<html>
<head>
  <% include ../partials/header.ejs %>
  <title>MyCO Map</title>
  <style>
    #map {
      height: 750px;
      width: 1000px;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <!--<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
    </script>-->
  <script type="text/javascript">
    function init() {
      var map = initMap();

      $.ajax({
        url: "/getMapData",
        type: "GET",
        success: function(res) {
          var json = JSON.parse(res);
          var locArr = json.locations.location;
          var locTypes = {
            "Distribution Facility": {
              marker: "http://www.googlemapsmarkers.com/v1/fc382a/",
              color: '#fc382a'
            },
            "HeadQuarters": {
              marker: "http://www.googlemapsmarkers.com/v1/ffffff/",
              color: '#ffffff'
            },
            "Call Center": {
              marker: "http://www.googlemapsmarkers.com/v1/8ce0ff/",
              color: '#8ce0ff'
            },
            "RetailLocation": {
              marker: "http://www.googlemapsmarkers.com/v1/32d137/",
              color: '#32d137'
            }
          }

          for(var i=0; i<locArr.length; i++) {
            var loc = locArr[i];
            var pos = new google.maps.LatLng(loc.latitude, loc.longitude);
            var marker = new google.maps.Marker({
              position: pos,
              icon: locTypes[loc.type].marker,
              label: loc.id + ': ' + loc.address,
              map: map
            });

            var circle = new google.maps.Circle({
              strokeColor: locTypes[loc.type].color,
              strokeOpacity: 0.8,
              strokeWeight: 2,
              fillColor: locTypes[loc.type].color,
              fillOpacity: 0.25,
              map: map,
              center: pos,
              radius: Math.sqrt(loc.$revenue)
          });
          }
        }
      });   
    }

    function initMap() {
      var center = {lat: 37.382093, lng: -122.001715};
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: center
      });/*
      var marker = new google.maps.Marker({
        position: center,
        map: map
      });*/
      return map;
    }
  </script>
</head>

<body onload="init();">

  <% include ../partials/nav.ejs %>

  <div id="map"></div>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdBpHQeF4cEh5apJbUgwVLdiDp7erK4LE&callback=initMap"
    async defer></script>
  
  <!--
  <br/><div id="mainDiv">
    <a type="button" class="btn btn-md btn-default" href="/getMapData">Seneca!</a>
  </div>-->

</body>
</html>




































